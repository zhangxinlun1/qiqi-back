# æœè£…åº—ç®¡ç†ç³»ç»Ÿ - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„æœè£…åº—ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå•†å“ç®¡ç†ã€åº“å­˜ç®¡ç†ã€é”€å”®ç®¡ç†ã€è¥ä¸šé¢ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•å°†ç³»ç»Ÿéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œå¹¶å°†æ•°æ®ä»localStorageè¿ç§»åˆ°MySQLæ•°æ®åº“ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx (80)    â”‚    â”‚   Frontend      â”‚    â”‚   Backend       â”‚
â”‚   åå‘ä»£ç†       â”‚â—„â”€â”€â–ºâ”‚   Vue3 + Vite   â”‚â—„â”€â”€â–ºâ”‚   NestJS        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º MySQL (3306)
                                                        â”‚
                                                        â””â”€â”€â–º Redis (6379)
```

## ğŸ“¦ æŠ€æœ¯æ ˆ

### å‰ç«¯
- **æ¡†æ¶**: Vue 3 + TypeScript
- **UIåº“**: Element Plus
- **æ„å»ºå·¥å…·**: Vite
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router

### åç«¯
- **æ¡†æ¶**: NestJS + TypeScript
- **æ•°æ®åº“**: MySQL 8.0
- **ORM**: TypeORM
- **ç¼“å­˜**: Redis
- **è®¤è¯**: JWT
- **æ–‡æ¡£**: Swagger

### éƒ¨ç½²
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **åå‘ä»£ç†**: Nginx
- **æ•°æ®æŒä¹…åŒ–**: Docker Volumes

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux/macOS/Windows
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **å†…å­˜**: è‡³å°‘ 2GB RAM
- **ç£ç›˜**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´

### 2. ä¸€é”®éƒ¨ç½²

#### Linux/macOS
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy-prod.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy-prod.sh
```

#### Windows
```cmd
# è¿è¡Œéƒ¨ç½²è„šæœ¬
deploy-prod.bat
```

### 3. æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p nginx/ssl mysql/init logs

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp apparel_admin_back/src/env.example apparel_admin_back/src/.env
cp vue3-admin-dashboard/env.example vue3-admin-dashboard/.env

# 3. å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d --build
```

## ğŸ“Š æ•°æ®è¿ç§»

### 1. å¯¼å‡ºlocalStorageæ•°æ®

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š

```javascript
// å¯¼å‡ºå•†å“æ•°æ®
console.log(JSON.stringify(JSON.parse(localStorage.getItem("products") || "[]"), null, 2));

// å¯¼å‡ºé”€å”®æ•°æ®
console.log(JSON.stringify(JSON.parse(localStorage.getItem("sales") || "[]"), null, 2));

// å¯¼å‡ºå…¥åº“æ•°æ®
console.log(JSON.stringify(JSON.parse(localStorage.getItem("stockIns") || "[]"), null, 2));
```

å°†è¾“å‡ºçš„JSONæ•°æ®ä¿å­˜åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
- `products.json` - å•†å“æ•°æ®
- `sales.json` - é”€å”®æ•°æ®
- `stockIns.json` - å…¥åº“æ•°æ®

### 2. è¿è¡Œæ•°æ®è¿ç§»

```bash
# å®‰è£…ä¾èµ–
npm install mysql2

# è¿è¡Œè¿ç§»è„šæœ¬
node migrate-data.js
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

#### åç«¯ç¯å¢ƒå˜é‡ (apparel_admin_back/src/.env)

```env
# æ•°æ®åº“é…ç½®
DB_HOST=mysql
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=woaini520.
DB_DATABASE=meeting_room_booking_system

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-here
JWT_ACCESS_TOKEN_EXPIRES_IN=30m
JWT_EXPIRES_IN=7d

# é‚®ä»¶é…ç½®
EMAIL_HOST=smtp.qq.com
EMAIL_PORT=587
EMAIL_USER=your-email@qq.com
EMAIL_PASS=your-email-password

# ä¸ƒç‰›äº‘é…ç½® (æ–‡ä»¶ä¸Šä¼ )
QINIU_ACCESS_KEY=your-qiniu-access-key
QINIU_SECRET_KEY=your-qiniu-secret-key
QINIU_BUCKET_NAME=your-bucket-name
QINIU_DOMAIN=your-qiniu-domain

# æœåŠ¡å™¨é…ç½®
PORT=3333
NODE_ENV=production
CORS_ORIGIN=http://localhost
```

#### å‰ç«¯ç¯å¢ƒå˜é‡ (vue3-admin-dashboard/.env)

```env
# APIé…ç½®
VITE_API_URL=http://localhost/api
VITE_REQUEST_TIMEOUT=5000

# åº”ç”¨é…ç½®
VITE_APP_TITLE=æœè£…åº—ç®¡ç†ç³»ç»Ÿ
VITE_APP_VERSION=1.0.0

# æ–‡ä»¶ä¸Šä¼ é…ç½®
VITE_UPLOAD_URL=http://localhost/api/file-upload/upload
```

### æ•°æ®åº“é…ç½®

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æ•°æ®è¡¨ï¼š

- `users` - ç”¨æˆ·è¡¨
- `roles` - è§’è‰²è¡¨
- `permissions` - æƒé™è¡¨
- `products` - å•†å“è¡¨
- `orders` - è®¢å•è¡¨
- `order_items` - è®¢å•é¡¹è¡¨
- `stock_ins` - å…¥åº“è®°å½•è¡¨
- `stock_in_items` - å…¥åº“é¡¹è¡¨
- `stock_adjustments` - åº“å­˜è°ƒæ•´è®°å½•è¡¨

## ğŸŒ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å‰ç«¯ç•Œé¢**: http://localhost
- **åç«¯API**: http://localhost/api
- **APIæ–‡æ¡£**: http://localhost/api
- **å¥åº·æ£€æŸ¥**: http://localhost/health

## ğŸ“ ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# åœæ­¢æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# æ›´æ–°æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d --build
```

### æ•°æ®åº“ç®¡ç†

```bash
# è¿æ¥æ•°æ®åº“
docker exec -it qiqi-back_mysql_1 mysql -u root -p

# å¤‡ä»½æ•°æ®åº“
docker exec qiqi-back_mysql_1 mysqldump -u root -p meeting_room_booking_system > backup.sql

# æ¢å¤æ•°æ®åº“
docker exec -i qiqi-back_mysql_1 mysql -u root -p meeting_room_booking_system < backup.sql
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f frontend

# æŸ¥çœ‹Nginxæ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f nginx
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

```bash
# ä¿®æ”¹æ•°æ®åº“å¯†ç 
docker exec -it qiqi-back_mysql_1 mysql -u root -p
ALTER USER 'root'@'%' IDENTIFIED BY 'your-new-password';
FLUSH PRIVILEGES;
```

### 2. é…ç½®HTTPS

1. å°†SSLè¯ä¹¦æ”¾å…¥ `nginx/ssl/` ç›®å½•
2. ä¿®æ”¹ `nginx/nginx.conf` ä¸­çš„HTTPSé…ç½®
3. é‡å¯NginxæœåŠ¡

### 3. é˜²ç«å¢™é…ç½®

```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 22
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_products_code ON products(code);
CREATE INDEX idx_orders_create_time ON orders(createTime);
CREATE INDEX idx_stock_ins_create_time ON stock_ins(createTime);
```

### 2. Redisç¼“å­˜

ç³»ç»Ÿå·²é…ç½®Redisç¼“å­˜ï¼Œç”¨äºï¼š
- ç”¨æˆ·ä¼šè¯ç®¡ç†
- å•†å“ç¼“å­˜
- ç»Ÿè®¡æ•°æ®ç¼“å­˜

### 3. Nginxä¼˜åŒ–

- å¯ç”¨Gzipå‹ç¼©
- é…ç½®é™æ€æ–‡ä»¶ç¼“å­˜
- å¯ç”¨HTTP/2

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :80
   netstat -tulpn | grep :3333
   
   # æ£€æŸ¥DockeræœåŠ¡
   docker ps -a
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   docker exec -it qiqi-back_mysql_1 mysql -u root -p
   
   # æ£€æŸ¥æ•°æ®åº“æ—¥å¿—
   docker-compose -f docker-compose.prod.yml logs mysql
   ```

3. **å‰ç«¯æ— æ³•è®¿é—®åç«¯**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   docker network ls
   docker network inspect qiqi-back_app-network
   ```

4. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ–‡ä»¶æƒé™
   ls -la apparel_admin_back/public/uploaded/
   
   # æ£€æŸ¥ç£ç›˜ç©ºé—´
   df -h
   ```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs --tail=100 | grep ERROR

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs nginx | grep "GET\|POST"
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **ç¯å¢ƒæ£€æŸ¥**
   - Dockerå’ŒDocker Composeæ˜¯å¦æ­£ç¡®å®‰è£…
   - ç«¯å£80ã€3333ã€3306ã€6379æ˜¯å¦è¢«å ç”¨
   - ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³

2. **é…ç½®æ£€æŸ¥**
   - ç¯å¢ƒå˜é‡æ–‡ä»¶æ˜¯å¦æ­£ç¡®åˆ›å»º
   - æ•°æ®åº“å¯†ç æ˜¯å¦æ­£ç¡®
   - ç½‘ç»œé…ç½®æ˜¯å¦æ­£ç¡®

3. **æœåŠ¡æ£€æŸ¥**
   - æ‰€æœ‰å®¹å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
   - æœåŠ¡é—´ç½‘ç»œæ˜¯å¦è¿é€š
   - æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Docker å®‰è£…æŒ‡å—](https://docs.docker.com/get-docker/)
- [Docker Compose å®‰è£…æŒ‡å—](https://docs.docker.com/compose/install/)
- [MySQL 8.0 æ–‡æ¡£](https://dev.mysql.com/doc/refman/8.0/en/)
- [Nginx é…ç½®æŒ‡å—](https://nginx.org/en/docs/)
- [NestJS æ–‡æ¡£](https://nestjs.com/)
- [Vue 3 æ–‡æ¡£](https://vuejs.org/)

---

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·åŠ¡å¿…ï¼š
1. ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
2. é…ç½®SSLè¯ä¹¦
3. è®¾ç½®é˜²ç«å¢™è§„åˆ™
4. å®šæœŸå¤‡ä»½æ•°æ®
5. ç›‘æ§ç³»ç»Ÿæ€§èƒ½ 